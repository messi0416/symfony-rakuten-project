<?php
/**
 * バッチ処理 ロケーション棚コード一覧更新処理
 */

namespace BatchBundle\Command;

use MiscBundle\Entity\Repository\TbWarehouseRepository;
use MiscBundle\Entity\SymfonyUsers;
use MiscBundle\Util\MultiInsertUtil;
use Symfony\Bundle\FrameworkBundle\Command\ContainerAwareCommand;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Input\InputOption;
use Symfony\Component\Console\Output\OutputInterface;

class RefreshLocationRackPlaceCodeCommand extends ContainerAwareCommand
{
  use CommandBaseTrait;

  private $account;

  private $results;

  protected function configure()
  {
    $this
      ->setName('batch:refresh-location-rack-place-code')
      ->setDescription('ロケーション棚コード一覧更新処理 ※棚マスタから振られる全ロケーション配置コードテーブルの再生成')
      ->addOption('account', null, InputOption::VALUE_OPTIONAL, '実行アカウント symfony_users.id')
      ;
  }

  protected function execute(InputInterface $input, OutputInterface $output)
  {
//    $container = $this->getContainer();
//    $logger = $this->getLogger();
//    $logger->info('ロケーション棚コード一覧更新処理を開始しました。');
//
//    // 実行アカウントの取得 (ログ記録PC, NEログインアカウント)
//    if ($accountId = $input->getOption('account')) {
//      /** @var SymfonyUsers $account */
//      $account = $container->get('doctrine')->getRepository('MiscBundle:SymfonyUsers')->find($accountId);
//      if ($account) {
//        $this->account = $account;
//        $logger->setAccount($account);
//      }
//    }
//
//    try {
//
//      $dbMain = $this->getDb('main');
//      $commonUtil = $this->getDbCommonUtil();
//
//      $this->results = [
//          'message' => null
//      ];
//
//      $logExecTitle = sprintf('ロケーション棚コード一覧更新処理');
//      $logger->setExecTitle($logExecTitle);
//      $logger->initLogTimer();
//      $logger->addDbLog($logger->makeDbLog($logExecTitle, $logExecTitle, '開始'));
//
//      // 棚マスタを取得し、それぞれに存在するはずの場所コードを作成する。
//      $rackInfoList = $this->rackMaster; // ひとまずはコード内にべた書き
//      $placeCodes = [];
//
//      $locationTypePlaces = [
//          'S' => ['L', 'M', 'R']
//        , 'C' => ['L', 'R']
//      ];
//
//      $placeCodeTypes = [
//        TbWarehouseRepository::DEFAULT_WAREHOUSE_ID => [ // 倉庫:1
//            8 => [
//              1 => 'S'
//            , 2 => 'S'
//            , 3 => 'S'
//            , 4 => 'S'
//            , 5 => 'S'
//            , 6 => 'S'
//            , 7 => 'S'
//            , 8 => 'S'
//          ]
//          , 6 => [
//              1 => 'C'
//            , 2 => 'C'
//            , 3 => 'S'
//            , 4 => 'S'
//            , 5 => 'S'
//            , 6 => 'S'
//          ]
//          , 4 => [
//              1 => 'S'
//            , 2 => 'S'
//            , 3 => 'S'
//            , 4 => 'S'
//          ]
//          , 3 => [
//              1 => 'C'
//            , 2 => 'C'
//            , 3 => 'S'
//          ]
//          , 2 => [
//              1 => 'C'
//            , 2 => 'C'
//          ]
//
//        ]
//        , 4 => [ // 倉庫:4 舞台倉庫
//          8 => [
//              1 => 'S'
//            , 2 => 'S'
//            , 3 => 'S'
//            , 4 => 'S'
//            , 5 => 'S'
//            , 6 => 'S'
//            , 7 => 'S'
//            , 8 => 'S'
//          ]
//          , 6 => [
//              1 => 'C'
//            , 2 => 'C'
//            , 3 => 'S'
//            , 4 => 'S'
//            , 5 => 'S'
//            , 6 => 'S'
//          ]
//        ]
//        , 5 => [ // 倉庫:5 南京終詰替前
//          8 => [
//              1 => 'S'
//            , 2 => 'S'
//            , 3 => 'S'
//            , 4 => 'S'
//            , 5 => 'S'
//            , 6 => 'S'
//            , 7 => 'S'
//            , 8 => 'S'
//          ]
//          , 6 => [
//              1 => 'C'
//            , 2 => 'C'
//            , 3 => 'S'
//            , 4 => 'S'
//            , 5 => 'S'
//            , 6 => 'S'
//          ]
//          , '5s' => [ // 天板がないための変則5段
//              1 => 'C'
//            , 2 => 'C'
//            , 3 => 'S'
//            , 4 => 'S'
//            , 5 => 'S'
//          ]
//        ]
//      ];
//
//      foreach ($rackInfoList as $rackInfo) {
//        $warehouseId = $rackInfo['warehouse_id'];
//        $racks = $rackInfo['racks'];
//        foreach($racks as $rack => $shelfNum) {
//          for ($i = 1; $i <= $shelfNum; $i++) {
//            $locationType = $placeCodeTypes[$warehouseId][$shelfNum][$i];
//            $locationTypePlaceList = $locationTypePlaces[$locationType];
//            foreach($locationTypePlaceList as $type) {
//              $placeCodes[] = [
//                  'warehouse_id' => $warehouseId
//                , 'rack_code'    => $rack
//                , 'place_code'   => sprintf('%d%s', $i, $type)
//                , 'location_type' => $locationType
//              ];
//            }
//          }
//        }
//      }
//
//      $insertBuilder = new MultiInsertUtil("tb_location_rack_place_code", [
//        'fields' => [
//            'warehouse_id'  => \PDO::PARAM_INT
//          , 'rack_code'     => \PDO::PARAM_STR
//          , 'place_code'    => \PDO::PARAM_STR
//          , 'location_type' => \PDO::PARAM_STR
//        ]
//        , 'prefix' => "INSERT INTO"
//      ]);
//
//      $dbMain->query("TRUNCATE tb_location_rack_place_code");
//
//      $commonUtil->multipleInsert($insertBuilder, $dbMain, $placeCodes, function($placeCode) {
//        $item = [
//            'warehouse_id'  => $placeCode['warehouse_id']
//          , 'rack_code'     => $placeCode['rack_code']
//          , 'place_code'    => $placeCode['place_code']
//          , 'location_type' => $placeCode['location_type']
//        ];
//
//        return $item;
//      });
//
//      // DB記録＆通知処理
//      $logger->addDbLog($logger->makeDbLog($logExecTitle, $logExecTitle, '終了'));
//      $logger->logTimerFlush();
//
//      $logger->info('ロケーション棚コード一覧更新処理を完了しました。');
//
//    } catch (\Exception $e) {
//
//      $logger->error('ロケーション棚コード一覧更新処理 エラー:' . $e->getMessage());
//      $logger->addDbLog(
//        $logger->makeDbLog('ロケーション棚コード一覧更新処理 エラー', 'ロケーション棚コード一覧更新処理 エラー', 'エラー終了')->setInformation($e->getMessage())
//        , true, 'ロケーション棚コード一覧更新処理 でエラーが発生しました。', 'error'
//      );
//
//      return 1;
//    }
//
//    return 0;
  }



//  private $rackMaster = [
//    [
//        'warehouse_id' => TbWarehouseRepository::DEFAULT_WAREHOUSE_ID // デフォルト倉庫（南京終）
//      , 'racks' => [
//
//          'D001' => 8
//        , 'D002' => 8
//        , 'D003' => 8
//        , 'D004' => 8
//        , 'D005' => 8
//        , 'D006' => 8
//        , 'D007' => 8
//        , 'D008' => 8
//        , 'D009' => 8
//        , 'D010' => 8
//        , 'D011' => 8
//
//        , 'D101' => 8
//        , 'D102' => 8
//        , 'D103' => 8
//        , 'D104' => 8
//        , 'D105' => 8
//        , 'D106' => 8
//        , 'D107' => 8
//        , 'D108' => 8
//        , 'D109' => 8
//        , 'D110' => 8
//        , 'D111' => 8
//        , 'D112' => 8
//        , 'D113' => 8
//        , 'D114' => 8
//        , 'D115' => 8
//        , 'D116' => 8
//        , 'D117' => 8
//        , 'D118' => 8
//        , 'D119' => 8
//        , 'D120' => 8
//        , 'D121' => 8
//        , 'D122' => 8
//        , 'D123' => 8
//        , 'D124' => 8
//        , 'D125' => 8
//        , 'D126' => 8
//        , 'D127' => 8
//        , 'D128' => 8
//        , 'D129' => 8
//        , 'D130' => 8
//        , 'D131' => 8
//        , 'D132' => 8
//        , 'D133' => 8
//        , 'D134' => 8
//        , 'D135' => 8
//
//        , 'D201' => 6
//        , 'D202' => 6
//        , 'D203' => 6
//        , 'D204' => 6
//
//        , 'D205' => 6
//        , 'D206' => 6
//        , 'D207' => 6
//        , 'D208' => 6
//        , 'D209' => 6
//        , 'D210' => 6
//        , 'D211' => 6
//        , 'D212' => 6
//        , 'D213' => 6
//        , 'D214' => 6
//        , 'D215' => 6
//        , 'D216' => 6
//
//        , 'D217' => 6
//        , 'D218' => 6
//        , 'D219' => 6
//        , 'D220' => 6
//        , 'D221' => 6
//        , 'D222' => 6
//        , 'D223' => 6
//        , 'D224' => 6
//        , 'D225' => 6
//        , 'D226' => 6
//        , 'D227' => 6
//        , 'D228' => 6
//
//        , 'D229' => 6
//        , 'D230' => 6
//        , 'D231' => 6
//        , 'D232' => 6
//
//        , 'D301' => 6
//        , 'D302' => 6
//        , 'D303' => 6
//        , 'D304' => 6
//        , 'D305' => 6
//        , 'D306' => 6
//        , 'D307' => 6
//        , 'D308' => 6
//        , 'D309' => 6
//        , 'D310' => 6
//        , 'D311' => 6
//        , 'D312' => 6
//        , 'D313' => 6
//        , 'D314' => 6
//        , 'D315' => 6
//        , 'D316' => 6
//        , 'D317' => 6
//        , 'D318' => 6
//        , 'D319' => 6
//        , 'D320' => 6
//        , 'D321' => 6
//        , 'D322' => 6
//        , 'D323' => 6
//        , 'D324' => 6
//        , 'D325' => 6
//        , 'D326' => 6
//        , 'D327' => 6
//        , 'D328' => 6
//        , 'D329' => 6
//        , 'D330' => 6
//        , 'D331' => 6
//        , 'D332' => 6
//
//        , 'D401' => 6
//        , 'D402' => 6
//        , 'D403' => 6
//        , 'D404' => 6
//        , 'D405' => 6
//        , 'D406' => 6
//        , 'D407' => 6
//        , 'D408' => 6
//        , 'D409' => 6
//        , 'D410' => 6
//        , 'D411' => 6
//        , 'D412' => 6
//        , 'D413' => 6
//        , 'D414' => 6
//        , 'D415' => 6
//        , 'D416' => 6
//        , 'D417' => 6
//        , 'D418' => 6
//        , 'D419' => 6
//        , 'D420' => 6
//        , 'D421' => 6
//        , 'D422' => 6
//        , 'D423' => 6
//        , 'D424' => 6
//        , 'D425' => 6
//        , 'D426' => 6
//        , 'D427' => 6
//        , 'D428' => 6
//        , 'D429' => 6
//        , 'D430' => 6
//        , 'D431' => 6
//        , 'D432' => 6
//
//        , 'D501' => 6
//        , 'D502' => 6
//        , 'D503' => 6
//        , 'D504' => 6
//        , 'D505' => 6
//        , 'D506' => 6
//        , 'D507' => 6
//        , 'D508' => 6
//        , 'D509' => 6
//        , 'D510' => 6
//        , 'D511' => 6
//        , 'D512' => 6
//        , 'D513' => 6
//        , 'D514' => 6
//        , 'D515' => 6
//        , 'D516' => 6
//        , 'D517' => 6
//        , 'D518' => 6
//        , 'D519' => 6
//        , 'D520' => 6
//        , 'D521' => 6
//        , 'D522' => 6
//        , 'D523' => 6
//        , 'D524' => 6
//        , 'D525' => 6
//        , 'D526' => 6
//
//        , 'D601' => 6
//        , 'D602' => 6
//        , 'D603' => 6
//        , 'D604' => 6
//        , 'D605' => 6
//        , 'D606' => 6
//
//        , 'D607' => 6
//        , 'D608' => 6
//        , 'D609' => 6
//        , 'D610' => 6
//        , 'D611' => 6
//        , 'D612' => 6
//        , 'D613' => 6
//        , 'D614' => 6
//        , 'D615' => 6
//        , 'D616' => 6
//        , 'D617' => 6
//        , 'D618' => 6
//        , 'D619' => 6
//        , 'D620' => 6
//        , 'D621' => 6
//        , 'D622' => 6
//        , 'D623' => 6
//        , 'D624' => 6
//        , 'D625' => 6
//        , 'D626' => 6
//        , 'D627' => 6
//        , 'D628' => 6
//        , 'D629' => 6
//
//        , 'D701' => 3
//        , 'D702' => 3
//        , 'D703' => 3
//        , 'D704' => 3
//        , 'D705' => 3
//
//        , 'D706' => 3
//        , 'D707' => 3
//
//        , 'D708' => 6
//        , 'D709' => 6
//        , 'D710' => 6
//        , 'D711' => 6
//        , 'D712' => 6
//        , 'D713' => 6
//        , 'D714' => 6
//        , 'D715' => 6
//        , 'D716' => 6
//        , 'D717' => 6
//        , 'D718' => 6
//        , 'D719' => 6
//        , 'D720' => 6
//        , 'D721' => 6
//        , 'D722' => 6
//        , 'D723' => 6
//
//        , 'D724' => 3
//
//        , 'D725' => 2
//
//        , 'D801' => 6
//        , 'D802' => 6
//        , 'D803' => 6
//        , 'D804' => 6
//        , 'D805' => 6
//        , 'D806' => 6
//        , 'D807' => 6
//        , 'D808' => 6
//        , 'D809' => 6
//        , 'D810' => 6
//        , 'D811' => 6
//        , 'D812' => 6
//        , 'D813' => 6
//        , 'D814' => 6
//        , 'D815' => 6
//        , 'D816' => 6
//        , 'D817' => 6
//        , 'D818' => 6
//        , 'D819' => 6
//        , 'D820' => 6
//        , 'D821' => 6
//        , 'D822' => 6
//
//        , 'E001' => 8
//        , 'E002' => 8
//        , 'E003' => 8
//
//        , 'E004' => 8
//        , 'E005' => 8
//        , 'E006' => 8
//        , 'E007' => 8
//        , 'E008' => 8
//
//        , 'E009' => 4
//        , 'E010' => 4
//        , 'E011' => 4
//        , 'E012' => 4
//        , 'E013' => 4
//        , 'E014' => 4
//        , 'E015' => 4
//        , 'E016' => 4
//
//        , 'E101' => 8
//        , 'E102' => 8
//        , 'E103' => 8
//        , 'E104' => 8
//        , 'E105' => 8
//        , 'E106' => 8
//        , 'E107' => 8
//        , 'E108' => 8
//        , 'E109' => 8
//        , 'E110' => 8
//        , 'E111' => 8
//        , 'E112' => 8
//        , 'E113' => 8
//        , 'E114' => 8
//        , 'E115' => 8
//        , 'E116' => 8
//
//        , 'E201' => 8
//        , 'E202' => 8
//        , 'E203' => 8
//        , 'E204' => 8
//        , 'E205' => 8
//        , 'E206' => 8
//        , 'E207' => 8
//        , 'E208' => 8
//        , 'E209' => 8
//        , 'E210' => 8
//        , 'E211' => 8
//        , 'E212' => 8
//        , 'E213' => 8
//        , 'E214' => 8
//        , 'E215' => 8
//        , 'E216' => 8
//
//        , 'E301' => 8
//        , 'E302' => 8
//        , 'E303' => 8
//        , 'E304' => 8
//        , 'E305' => 8
//        , 'E306' => 8
//        , 'E307' => 8
//        , 'E308' => 8
//        , 'E309' => 8
//        , 'E310' => 8
//        , 'E311' => 8
//        , 'E312' => 8
//        , 'E401' => 8
//        , 'E402' => 8
//        , 'E403' => 8
//        , 'E404' => 8
//        , 'E405' => 8
//        , 'E406' => 8
//        , 'E407' => 8
//        , 'E408' => 8
//        , 'E409' => 8
//        , 'E410' => 8
//
//        , 'E501' => 8
//        , 'E502' => 8
//        , 'E503' => 8
//        , 'E504' => 8
//        , 'E505' => 8
//        , 'E506' => 8
//        , 'E507' => 8
//        , 'E508' => 8
//        , 'E509' => 8
//        , 'E510' => 8
//        , 'E511' => 8
//        , 'E512' => 8
//
//        , 'E601' => 8
//        , 'E602' => 8
//        , 'E603' => 8
//        , 'E604' => 8
//        , 'E605' => 8
//        , 'E606' => 8
//        , 'E607' => 8
//        , 'E608' => 8
//
//        , 'E609' => 4
//        , 'E610' => 4
//        , 'E611' => 4
//        , 'E612' => 4
//        , 'E613' => 4
//        , 'E614' => 4
//        , 'E615' => 4
//        , 'E616' => 4
//
//        , 'E701' => 8
//        , 'E702' => 8
//
//        , 'F101' => 8
//        , 'F102' => 8
//        , 'F103' => 8
//        , 'F104' => 8
//        , 'F105' => 8
//        , 'F106' => 8
//        , 'F107' => 8
//        , 'F108' => 8
//        , 'F109' => 8
//        , 'F110' => 8
//        , 'F111' => 8
//        , 'F112' => 8
//        , 'F113' => 8
//        , 'F114' => 8
//        , 'F115' => 8
//
//        , 'F201' => 8
//        , 'F202' => 8
//        , 'F203' => 8
//        , 'F204' => 8
//        , 'F205' => 8
//        , 'F206' => 8
//        , 'F207' => 8
//        , 'F208' => 8
//        , 'F209' => 8
//        , 'F210' => 8
//        , 'F211' => 8
//        , 'F212' => 8
//        , 'F213' => 8
//        , 'F214' => 8
//        , 'F215' => 8
//        , 'F216' => 8
//
//        , 'F301' => 8
//        , 'F302' => 8
//        , 'F303' => 8
//        , 'F304' => 8
//        , 'F305' => 8
//        , 'F306' => 8
//        , 'F307' => 8
//        , 'F308' => 8
//        , 'F309' => 8
//        , 'F310' => 8
//        , 'F311' => 8
//        , 'F312' => 8
//        , 'F313' => 8
//        , 'F314' => 8
//        , 'F315' => 8
//        , 'F316' => 8
//
//        , 'F401' => 8
//        , 'F402' => 8
//        , 'F403' => 8
//        , 'F404' => 8
//        , 'F405' => 8
//        , 'F406' => 8
//        , 'F407' => 8
//        , 'F408' => 8
//        , 'F409' => 8
//        , 'F410' => 8
//        , 'F411' => 8
//        , 'F412' => 8
//        , 'F413' => 8
//        , 'F414' => 8
//        , 'F415' => 8
//
//        , 'F501' => 8
//        , 'F502' => 8
//        , 'F503' => 8
//        , 'F504' => 8
//        , 'F505' => 8
//        , 'F506' => 8
//        , 'F507' => 8
//        , 'F508' => 8
//        , 'F509' => 8
//        , 'F510' => 8
//        , 'F511' => 8
//        , 'F512' => 8
//        , 'F513' => 8
//        , 'F514' => 8
//
//        , 'F601' => 8
//        , 'F602' => 8
//        , 'F603' => 8
//        , 'F604' => 8
//        , 'F605' => 8
//        , 'F606' => 8
//        , 'F607' => 8
//        , 'F608' => 8
//        , 'F609' => 8
//        , 'F610' => 8
//        , 'F611' => 8
//        , 'F612' => 8
//        , 'F613' => 8
//        , 'F614' => 8
//
//        , 'F701' => 8
//        , 'F702' => 8
//        , 'F703' => 8
//        , 'F704' => 8
//        , 'F705' => 8
//        , 'F706' => 8
//        , 'F707' => 8
//        , 'F708' => 8
//        , 'F709' => 8
//        , 'F710' => 8
//        , 'F711' => 8
//        , 'F712' => 8
//        , 'F713' => 8
//
//        , 'F801' => 8
//        , 'F802' => 8
//        , 'F803' => 8
//        , 'F804' => 8
//        , 'F805' => 8
//        , 'F806' => 8
//      ]
//    ]
//
//    , [
//        'warehouse_id' => 4 // 舞台倉庫
//      , 'racks' => [
//          'G101' => 8
//        , 'G102' => 8
//        , 'G103' => 8
//        , 'G104' => 8
//        , 'G105' => 8
//        , 'G106' => 8
//        , 'G107' => 8
//        , 'G108' => 8
//        , 'G109' => 8
//        , 'G110' => 8
//        , 'G111' => 8
//        , 'G112' => 8
//        , 'G113' => 8
//        , 'G114' => 8
//        , 'G115' => 8
//        , 'H112' => 8
//        , 'H113' => 8
//        , 'H114' => 8
//        , 'H115' => 8
//
//        , 'H201' => 8
//        , 'H202' => 8
//        , 'H203' => 8
//        , 'H204' => 8
//        , 'H205' => 8
//        , 'H206' => 8
//        , 'H207' => 8
//        , 'H208' => 8
//        , 'H209' => 8
//        , 'H210' => 8
//        , 'H211' => 8
//        , 'H212' => 8
//        , 'H213' => 8
//        , 'H214' => 8
//        , 'H215' => 8
//        , 'H216' => 8
//
//        , 'H301' => 8
//        , 'H302' => 8
//        , 'H303' => 8
//        , 'H304' => 8
//        , 'H305' => 8
//
//        , 'H306' => 8
//        , 'H307' => 8
//        , 'H308' => 8
//        , 'H309' => 8
//        , 'H310' => 8
//        , 'H311' => 8
//        , 'H312' => 8
//        , 'H313' => 8
//        , 'H314' => 8
//        , 'H315' => 8
//        , 'H316' => 8
//
//        , 'H401' => 8
//        , 'H402' => 8
//        , 'H403' => 8
//        , 'H404' => 8
//        , 'H405' => 8
//        , 'H406' => 8
//        , 'H407' => 8
//        , 'H408' => 8
//        , 'H409' => 8
//        , 'H410' => 8
//        , 'H411' => 8
//        , 'H412' => 8
//        , 'H413' => 8
//        , 'H414' => 8
//        , 'H415' => 8
//        , 'H416' => 8
//      ]
//    ]
//
//    , [
//        'warehouse_id' => 5 // 南京終詰替前
//      , 'racks' => [
//          'A101' => 8
//        , 'A102' => 8
//        , 'A103' => 8
//        , 'A104' => 8
//        , 'A105' => 6
//        , 'A106' => 6
//        , 'A107' => 6
//        , 'A108' => 6
//
//        , 'A109' => 8
//        , 'A110' => 8
//      ]
//    ]
//
//  ];
}


